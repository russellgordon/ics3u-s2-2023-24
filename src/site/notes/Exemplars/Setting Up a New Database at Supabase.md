---
{"dg-publish":true,"permalink":"/exemplars/setting-up-a-new-database-at-supabase/","dgHomeLink":true,"dgShowToc":true}
---

# Setting Up a New Database at Supabase

## ER Diagram

This is Mr. Gordon's [[Concepts/Entity-Relationship Diagrams\|entity-relationship diagram]] for his [ReadWell exemplar app](https://www.russellgordon.ca/lcs/2023-24/ics3u/App_Prototype_Exemplar.zip):

![IMG_4310 Large.png](/img/user/Media/IMG_4310%20Large.png)

There are more entities than you might initially think, as Mr. Gordon hopes to extend the app in the future so that users can share reviews of books with one another.

### Cardinalities

- **reader-review**
	- A given **reader** will write many reviews.
	- A given **review** is authored by one reader.
	- Looking from **reader** to **review** there is a *one-to-many* relationship.
	- Looking from **review** to **reader** there is a *many-to-one* relationship.
- **review-book**
	- A given **review** rates one book.
	- A given **book** will be rated many times.
	- Looking from **review** to **book** there is a *many-to-one* relationship.
	- Looking from **book** to **review** there is a *one-to-many* relationship.
- **book-reader**
	- A given **book** will be read by many readers over time.
	- A given **reader** will read many books over time.
	- Looking from **book** to **reader** there is a *many-to-many*  relationship.
	- Looking from **reader** to **book** there is a *many-to-many*  relationship.
- **book-genre**
	- A given **book** belongs to many genres.
	- A given **genre** will include many books.
	- Looking from **book** to **genre** there is a *many-to-many*  relationship.
	- Looking from **genre** to **book** there is a *many-to-many*  relationship.
 - **book-author**
	- A given **book** could be written by many authors.
	- A given **author** will write many books over time.
	- Looking from **book** to **author** there is a *many-to-many*  relationship.
	- Looking from **author** to **book** there is a *many-to-many*  relationship.
 
## ChatGPT prompts

### Database schema

Mr. Gordon provided the following prompt to ChatGPT to obtain the SQL to create the table structure that matches the ER diagram above:

```
This is a photo of a hand-drawn conceptual entity-relationship diagram. 

The diagram describes the data that is used by a book journaling app, where a given reader writes personal reviews of books they have read. The purpose of the app is to help a reader remember what books they have read in the past: which books they liked, which books they did not like, and why.

Please convert this image into valid SQL that will create database tables with columns, primary keys, and foreign keys where appropriate based on the cardinality described in the diagram.

Do your best to infer data types for table columns based on the name of attributes given for each entity.

Be certain that the SQL you generate is compatible with the PostgreSQL database software.
```
 
Here is the output that Mr. Gordon received:

```sql
-- Create table for Reader
CREATE TABLE reader (
    id SERIAL PRIMARY KEY,
    first_name VARCHAR(100),
    last_name VARCHAR(100)
);

-- Create table for Author
CREATE TABLE author (
    id SERIAL PRIMARY KEY,
    first_name VARCHAR(100),
    last_name VARCHAR(100),
    middle_names_or_initials VARCHAR(100)
);

-- Create table for Genre
CREATE TABLE genre (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100)
);

-- Create table for Book
CREATE TABLE book (
    id SERIAL PRIMARY KEY,
    title VARCHAR(255),
    genre_id INT,
    FOREIGN KEY (genre_id) REFERENCES genre(id)
);

-- Create table for Review
CREATE TABLE review (
    id SERIAL PRIMARY KEY,
    date_started_reading DATE,
    date_finished_reading DATE,
    review_details TEXT,
    rating_out_of_five_stars INT,
    book_id INT,
    reader_id INT,
    FOREIGN KEY (book_id) REFERENCES book(id),
    FOREIGN KEY (reader_id) REFERENCES reader(id)
);

-- Create table for Reads (junction table between reader and book)
CREATE TABLE reads (
    reader_id INT,
    book_id INT,
    PRIMARY KEY (reader_id, book_id),
    FOREIGN KEY (reader_id) REFERENCES reader(id),
    FOREIGN KEY (book_id) REFERENCES book(id)
);

-- Create table for Writes (junction table between author and book)
CREATE TABLE writes (
    author_id INT,
    book_id INT,
    PRIMARY KEY (author_id, book_id),
    FOREIGN KEY (author_id) REFERENCES author(id),
    FOREIGN KEY (book_id) REFERENCES book(id)
);
```

Here is the description of these tables as generated by ChatGPT:

> In this schema:
> - The `reader` table holds information about readers.
> - The `author` table holds information about authors.
> - The `genre` table holds information about genres.
> - The `book` table holds information about books and has a foreign key referencing the `genre` table.
> - The `review` table holds reviews written by readers and has foreign keys referencing both the `book` and `reader` tables.
> - The `reads` table is a junction table representing the relationship between readers and books they read.
> - The `writes` table is a junction table representing the relationship between authors and the books they wrote.
> 
> Each table and column is defined with appropriate data types inferred from their names, and primary and foreign keys are set to maintain relational integrity.

The schema ChatGPT has produced looks reasonable, although it missed the fact that Mr. Gordon wanted to have an image attached to a given review – so the reader could, for example, take a snapshot of the book they have read. That's OK – Mr. Gordon can add that column in to his `review` table later.

From here, Mr. Gordon provided the following prompt to ChatGPT to obtain the SQL to create the table structure that matches the ER diagram above:

```
That's great, thank-you!

Now given the SQL you just produced to create the database tables that matched the ER diagram, can you produce some further SQL that will populate each table with reasonable sample data?

Ensure that there are at least a dozen books reviewed, by three different readers, across four genres.
```

Here was the response from ChatGPT:

> Sure! Below is the SQL to populate the tables with sample data, ensuring that there are at least a dozen books reviewed by three different readers across four genres.

```sql
-- Insert sample data into reader table
INSERT INTO reader (first_name, last_name) VALUES 
('John', 'Doe'),
('Jane', 'Smith'),
('Alice', 'Johnson');

-- Insert sample data into author table
INSERT INTO author (first_name, last_name, middle_names_or_initials) VALUES 
('Mark', 'Twain', NULL),
('Jane', 'Austen', NULL),
('George', 'Orwell', 'Eric Arthur'),
('J.K.', 'Rowling', NULL),
('Agatha', 'Christie', NULL);

-- Insert sample data into genre table
INSERT INTO genre (name) VALUES 
('Fiction'),
('Mystery'),
('Fantasy'),
('Science Fiction');

-- Insert sample data into book table
INSERT INTO book (title, genre_id) VALUES 
('The Adventures of Tom Sawyer', 1),
('Pride and Prejudice', 1),
('1984', 4),
('Harry Potter and the Philosopher\'s Stone', 3),
('Murder on the Orient Express', 2),
('The Hobbit', 3),
('Fahrenheit 451', 4),
('The Catcher in the Rye', 1),
('The Great Gatsby', 1),
('To Kill a Mockingbird', 1),
('Brave New World', 4),
('The Lord of the Rings', 3);

-- Insert sample data into writes table
INSERT INTO writes (author_id, book_id) VALUES 
(1, 1), 
(2, 2), 
(3, 3), 
(4, 4), 
(5, 5),
(4, 6),
(3, 7),
(2, 8),
(1, 9),
(5, 10),
(3, 11),
(4, 12);

-- Insert sample data into reads table
INSERT INTO reads (reader_id, book_id) VALUES 
(1, 1), 
(1, 2), 
(1, 3), 
(1, 4), 
(2, 5), 
(2, 6), 
(2, 7), 
(2, 8), 
(3, 9), 
(3, 10), 
(3, 11), 
(3, 12);

-- Insert sample data into review table
INSERT INTO review (date_started_reading, date_finished_reading, review_details, rating_out_of_five_stars, book_id, reader_id) VALUES 
('2023-01-01', '2023-01-10', 'A wonderful adventure.', 5, 1, 1),
('2023-02-01', '2023-02-15', 'A timeless romance.', 4, 2, 1),
('2023-03-01', '2023-03-10', 'A dystopian masterpiece.', 5, 3, 1),
('2023-04-01', '2023-04-10', 'A magical journey.', 5, 4, 1),
('2023-05-01', '2023-05-15', 'A thrilling mystery.', 4, 5, 2),
('2023-06-01', '2023-06-10', 'An epic fantasy.', 5, 6, 2),
('2023-07-01', '2023-07-10', 'A thought-provoking story.', 4, 7, 2),
('2023-08-01', '2023-08-10', 'A classic novel.', 4, 8, 2),
('2023-09-01', '2023-09-10', 'A heartbreaking tale.', 5, 9, 3),
('2023-10-01', '2023-10-10', 'A fascinating look at society.', 5, 10, 3),
('2023-11-01', '2023-11-10', 'A visionary work.', 4, 11, 3),
('2023-12-01', '2023-12-10', 'An unforgettable adventure.', 5, 12, 3);
```

> This SQL script:
> - Inserts sample readers, authors, genres, books, and relationships between books and authors.
> - Links readers to the books they have read.
> - Adds sample reviews for each book read by the readers.
> 
> This setup ensures that the database is populated with sufficient data to demonstrate the relationships and functionality as described in the ER diagram.

The sample data looked pretty good, but the reviews themselves are a bit brief. Mr. Gordon decided to prompt ChatGPT to try again, as follows:

```
Please adjust the SQL you just produced so that the contents of the review_details column for a given review are longer. Remember, this is a personal review of a book made by a given reader. They need to remember why they liked, or did not like, the book. There should be more personal details in the review_details column for each review.
```

Here's what ChatGPT came up with the second time:

> Certainly! Here is the adjusted SQL script with more detailed content for the `review_details` column for each review:

```sql
-- Insert sample data into reader table
INSERT INTO reader (first_name, last_name) VALUES 
('John', 'Doe'),
('Jane', 'Smith'),
('Alice', 'Johnson');

-- Insert sample data into author table
INSERT INTO author (first_name, last_name, middle_names_or_initials) VALUES 
('Mark', 'Twain', NULL),
('Jane', 'Austen', NULL),
('George', 'Orwell', 'Eric Arthur'),
('J.K.', 'Rowling', NULL),
('Agatha', 'Christie', NULL);

-- Insert sample data into genre table
INSERT INTO genre (name) VALUES 
('Fiction'),
('Mystery'),
('Fantasy'),
('Science Fiction');

-- Insert sample data into book table
INSERT INTO book (title, genre_id) VALUES 
('The Adventures of Tom Sawyer', 1),
('Pride and Prejudice', 1),
('1984', 4),
('Harry Potter and the Philosopher\'s Stone', 3),
('Murder on the Orient Express', 2),
('The Hobbit', 3),
('Fahrenheit 451', 4),
('The Catcher in the Rye', 1),
('The Great Gatsby', 1),
('To Kill a Mockingbird', 1),
('Brave New World', 4),
('The Lord of the Rings', 3);

-- Insert sample data into writes table
INSERT INTO writes (author_id, book_id) VALUES 
(1, 1), 
(2, 2), 
(3, 3), 
(4, 4), 
(5, 5),
(4, 6),
(3, 7),
(2, 8),
(1, 9),
(5, 10),
(3, 11),
(4, 12);

-- Insert sample data into reads table
INSERT INTO reads (reader_id, book_id) VALUES 
(1, 1), 
(1, 2), 
(1, 3), 
(1, 4), 
(2, 5), 
(2, 6), 
(2, 7), 
(2, 8), 
(3, 9), 
(3, 10), 
(3, 11), 
(3, 12);

-- Insert sample data into review table
INSERT INTO review (date_started_reading, date_finished_reading, review_details, rating_out_of_five_stars, book_id, reader_id) VALUES 
('2023-01-01', '2023-01-10', 'A wonderful adventure. This book brought back memories of childhood. The characters were so relatable and the story was full of fun and excitement. I loved the way Twain described the setting, it felt like I was right there with Tom and Huck. Definitely a must-read for all ages.', 5, 1, 1),
('2023-02-01', '2023-02-15', 'A timeless romance. I was captivated by the witty dialogue and the complex characters. Austen\'s portrayal of Elizabeth Bennet is brilliant, and the chemistry between her and Mr. Darcy kept me hooked until the end. This book is a beautiful exploration of love, pride, and societal expectations.', 4, 2, 1),
('2023-03-01', '2023-03-10', 'A dystopian masterpiece. Orwell\'s vision of the future is terrifying and thought-provoking. The themes of surveillance, government control, and the loss of individual freedoms are more relevant than ever. This book made me question the world we live in and the direction we are heading. A powerful read.', 5, 3, 1),
('2023-04-01', '2023-04-10', 'A magical journey. This book transported me to a world of wonder and enchantment. Rowling\'s writing is engaging and the story is full of surprises. I was completely immersed in Harry\'s world and couldn\'t put the book down. It\'s a story of friendship, bravery, and the fight against evil. Highly recommended.', 5, 4, 1),
('2023-05-01', '2023-05-15', 'A thrilling mystery. Christie is the queen of mystery and this book is a perfect example of her genius. The plot twists and turns kept me guessing until the very end. Poirot\'s character is fascinating and his detective skills are unmatched. A classic whodunit that will keep you on the edge of your seat.', 4, 5, 2),
('2023-06-01', '2023-06-10', 'An epic fantasy. Tolkien\'s world-building is unparalleled. The story is rich with detail and the characters are unforgettable. The journey of Bilbo Baggins is both thrilling and heartwarming. This book is a cornerstone of fantasy literature and a must-read for anyone who loves a good adventure.', 5, 6, 2),
('2023-07-01', '2023-07-10', 'A thought-provoking story. Bradbury\'s vision of a society obsessed with media and censorship is chilling. The themes of knowledge, freedom, and individuality are explored in a powerful way. This book made me reflect on the importance of books and the dangers of losing our ability to think critically. A timeless classic.', 4, 7, 2),
('2023-08-01', '2023-08-10', 'A classic novel. Salinger\'s portrayal of teenage angst and rebellion is raw and honest. Holden Caulfield\'s voice is unique and his journey is both heartbreaking and enlightening. This book captures the struggles of growing up and finding one\'s place in the world. A must-read for anyone who has ever felt lost.', 4, 8, 2),
('2023-09-01', '2023-09-10', 'A heartbreaking tale. Fitzgerald\'s writing is beautiful and his portrayal of the American Dream is both glamorous and tragic. The characters are complex and their stories are intertwined in a way that is both compelling and devastating. This book is a poignant exploration of love, wealth, and the pursuit of happiness.', 5, 9, 3),
('2023-10-01', '2023-10-10', 'A fascinating look at society. Lee\'s novel is a powerful exploration of race, justice, and morality. The characters are deeply human and their struggles are heart-wrenching. This book made me think about the world in a new way and appreciate the importance of standing up for what is right. An essential read.', 5, 10, 3),
('2023-11-01', '2023-11-10', 'A visionary work. Huxley\'s depiction of a future society is both frightening and thought-provoking. The themes of control, technology, and the loss of individuality are explored in a way that is both captivating and disturbing. This book made me question the direction of our society and the price of progress. A must-read.', 4, 11, 3),
('2023-12-01', '2023-12-10', 'An unforgettable adventure. Tolkien\'s masterpiece is a monumental work of fantasy literature. The world he created is rich and immersive, and the characters are iconic. The journey of Frodo and the Fellowship is epic in scope and full of moments of bravery, sacrifice, and friendship. This book is a treasure.', 5, 12, 3);
```

> These entries for the `review_details` column are more detailed and personal, providing insights into why each reader liked or did not like a particular book.

Ehhh... Mr. Gordon still thinks those reviews don't sound much like what a real person would write in a personal review of a book they have read, but it's not important right now. At least there will be more text to show in the app as we connect the database to the static layouts.

## Create the database

### Create Supabase project

Next, 